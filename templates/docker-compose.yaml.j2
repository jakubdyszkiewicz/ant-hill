---
version: "2"
services:
  plex:
    image: lscr.io/linuxserver/plex
    container_name: plex
    network_mode: host
    environment:
      - PUID=1000
      - PGID=1000
      - VERSION=docker
    volumes:
      - /mnt/data/services/plex:/config
      - /mnt/media/movies:/movies
      - /mnt/media/tvshows:/tvshows
    restart: unless-stopped
  syncthing:
    image: linuxserver/syncthing
    container_name: syncthing
    volumes:
      - /mnt/data/services/syncthing:/config
      - /mnt/data/sync:/mnt/data/sync
    restart: unless-stopped
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/Warsaw
    ports:
      - 8384:8384
      - 22000:22000/tcp
      - 22000:22000/udp
      - 21027:21027/udp
  nzbget:
    image: linuxserver/nzbget
    container_name: nzbget
    volumes:
      - /mnt/data/services/nzbget:/config
      - /mnt/media/downloads:/downloads
    restart: always
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/Warsaw
    ports:
      - 6789:6789
  sonarr:
    image: linuxserver/sonarr
    container_name: sonarr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=PST
      - UMASK_SET=022 #optional
    volumes:
      - /mnt/data/services/sonarr:/config
      - /mnt/media/tvshows:/mnt/media
      - /mnt/media/downloads:/downloads
    ports:
      - 8989:8989
    restart: unless-stopped
  radarr:
    image: linuxserver/radarr
    container_name: radarr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=PST
    volumes:
      - /mnt/data/services/radarr:/config
      - /mnt/media/movies:/mnt/media
      - /mnt/media/downloads:/downloads
    ports:
      - 7878:7878
    restart: unless-stopped
  pihole:
    container_name: pihole
    image: pihole/pihole:latest
    network_mode: host
    environment:
      - TZ=Europe/Warsaw
      - WEBPASSWORD=piholepasswd
      - WEB_PORT=7080
      - DNSMASQ_LISTENING=single
      - INTERFACE=enp1s0
      - CORS_HOSTS=pihole.{{ ant_domain }}
    volumes:
      - /mnt/data/services/pihole:/etc/pihole
      - /mnt/data/services/dnsmasq:/etc/dnsmasq.d
    restart: unless-stopped
  ddclient:
    image: lscr.io/linuxserver/ddclient
    container_name: ddclient
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/Warsaw
    volumes:
      - /mnt/data/services/ddclient:/config
    restart: unless-stopped
  duplicacy:
    container_name: duplicacy
    image: saspus/duplicacy-web
    hostname: duplicacy-web
    restart: unless-stopped
    ports:
      - 3875:3875
    environment:
      - USR_ID=1000
      - GRP_ID=1000
      - TZ=Europe/Warsaw
    volumes:
      - /mnt/data/services/duplicacy:/config
      - /home/jakub/docker-services/duplicacy/cache:/cache
      - /home/jakub/docker-services/duplicacy/logs:/logs
      - /mnt/data:/data:ro
  gickup:
    container_name: gickup
    image: buddyspencer/gickup:latest
    user: '1000:1000'
    volumes:
      - /mnt/data/services/gickup/conf.yml:/gickup/conf.yml
      - /mnt/data/gickup:/data
    command: ["./gickup/app", "/gickup/conf.yml"]
  rclone:
    container_name: rclone
    image: rclone/rclone:latest
      #restart: unless-stopped
    user: '1000:1000'
    volumes:
      - /mnt/data/services/rclone:/config/rclone
      - /mnt/data/gdrive:/data
    entrypoint: ["/bin/sh", "-c"]
    command: ["while true; do echo 'Syncing...'; /usr/local/bin/rclone sync -v --drive-acknowledge-abuse gdrive:/ /data/; echo 'Sleeping for 1h'; sleep 3600; done"]
  kong:
    image: kong
    user: root
    container_name: kong
    network_mode: host
    environment:
      - KONG_DATABASE=off
      - KONG_DECLARATIVE_CONFIG=/usr/local/kong/declarative/kong.yml
      - KONG_PROXY_ACCESS_LOG=/dev/stdout
      - KONG_ADMIN_ACCESS_LOG=/dev/stdout
      - KONG_PROXY_ERROR_LOG=/dev/stderr
      - KONG_ADMIN_ERROR_LOG=/dev/stderr
      - KONG_ADMIN_LISTEN=0.0.0.0:8001, 0.0.0.0:8444 ssl
      - KONG_PROXY_LISTEN=0.0.0.0:80, 0.0.0.0:443 ssl
      - KONG_SSL_CERT=/certs/keys/letsencrypt/fullchain.pem
      - KONG_SSL_CERT_KEY=/certs/keys/letsencrypt/privkey.pem
    volumes:
      - /mnt/data/services/kong:/usr/local/kong/declarative
      - /mnt/data/services/swag:/certs
    restart: unless-stopped
  swag:
    image: lscr.io/linuxserver/swag
    container_name: swag
    cap_add:
      - NET_ADMIN
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/Warsaw
      - URL={{ ant_domain }} 
      - VALIDATION=dns
      - SUBDOMAINS=wildcard
      - DNSPLUGIN=ovh
      - "EMAIL=jakub.dyszkiewicz@gmail.com"
      - STAGING=false
    volumes:
      - /mnt/data/services/swag:/config
    restart: unless-stopped
  samba:
    image: crazymax/samba
    container_name: samba
    network_mode: host
    volumes:
      - /home/ubuntu/docker-services/samba:/data
      - /mnt/data/nas:/nas
      - /mnt/data/backup/timemachine:/timemachine
    environment:
      - TZ=Europe/Warsaw
      - SAMBA_LOG_LEVEL=0
    restart: unless-stopped